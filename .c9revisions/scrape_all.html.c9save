{"ts":1358472199306,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<html>\n\t<head>\n\t\t<title>Game Check</title>\n\t\t<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\n\t\t<meta name=\"viewport\" content=\"width=device-width,user-scalable=no\" />\n\t\t<meta name=\"apple-mobile-web-app-capable\" content=\"yes\" />  \n\t\t<meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black\" /> \n\t\t\n\t\t<link rel=\"apple-touch-icon-precomposed\" href=\"thumbicon.png\"/>  \t\t\n\t\t<link rel=\"apple-touch-startup-image\" href=\"splash.png\" />  \n\n\t\t<link rel=\"stylesheet/less\" type=\"text/css\" href=\"lib/style.less\">\n\t\t<script type=\"text/javascript\">\n\t\t\tless = { env: 'development' };\n\t\t</script>\n\t\t<script type=\"text/javascript\" src=\"lib/less-1.3.0.min.js\"></script>\n\t\t<script type=\"text/javascript\" src=\"lib/jquery.min.js\"></script>\n\t\t<script type=\"text/javascript\" src=\"lib/jsrender.js\"></script>\n\t\t<script type=\"text/javascript\" src=\"https://raw.github.com/timrwood/moment/1.7.2/min/moment.min.js\"></script>\n\t\t<style type=\"text/css\">\n\t\t\tiframe{width: 10px;height:10px;}\n\t\t</style>\n\t\t<script type=\"text/javascript\">\n\t\t\tfunction clean(actual){\n\t\t\t  var newArray = new Array();\n\t\t\t  for(var i = 0; i<actual.length; i++){\n\t\t\t\t  if (actual[i]){\n\t\t\t\t\tnewArray.push(actual[i]);\n\t\t\t\t}\n\t\t\t  }\n\t\t\t  return newArray;\n\t\t\t}\n\t\t\tArray.prototype.clean = function(deleteValue) {\n\t\t\t  for (var i = 0; i < this.length; i++) {\n\t\t\t\tif (this[i] == deleteValue) {         \n\t\t\t\t  this.splice(i, 1);\n\t\t\t\t  i--;\n\t\t\t\t}\n\t\t\t  }\n\t\t\t  return this;\n\t\t\t};\n\t\t\tvar alldone = 0;\n\t\t\tvar bigData = {};\n\t\t\tvar allframes = [];\n\t\t\tvar delay = (function(){\n\t\t\t\tvar timer = 0;\n\t\t\t\treturn function(callback, ms){\n\t\t\t\t\tclearTimeout (timer);\n\t\t\t\t\ttimer = setTimeout(callback, ms);\n\t\t\t\t};\n\t\t\t})();\n\t\t\t\n\t\t\tvar main = function(){}\n\t\t\t\n\t\t\tmain.prototype.init = function(opts){\n\t\t\t\tvar _this = this;\n\t\t\t\tconsole.log('init');\n\t\t\t\t_this.opts = opts;\n\t\t\t\t$.map(_this.opts.consoles,function(i){\n\t\t\t\t\tbigData[i] = new Array();\n\t\t\t\t})\n\t\t\t\t//_this.getAllGames();\n\t\t\t\tsetTimeout(function(){_this.getEachGameMeta()},100);\n\t\t\t\t\n\t\t\t}\n\t\t\tmain.prototype.addSafeName = function(){\n\t\t\t\t$.getJSON('console_obj.json',function(r){\n\t\t\t\t\t//bigData = r;\n\t\t\t\t\t$.map(r,function(v,k){\n\t\t\t\t\t\tconsole.log('////////////////////////');\n\t\t\t\t\t\tconsole.log(k);\n\t\t\t\t\t\tconsole.log('////////////////////////');\n\t\t\t\t\t\t$.map(v,function(vv,kk){\n\t\t\t\t\t\t\tvar name = encodeURIComponent(vv.name.replace(/[:-\\s]/g,'-').replace(/[\\?!\\\\\\/]/g,'').replace(/\\./g,'-').replace(/--/g,'-').toLowerCase()).replace(/%26/g,'&').replace(/%2C/g,',');\n\t\t\t\t\t\t\tvv.safename = name;\n\t\t\t\t\t\t\tbigData[k].push(vv);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\tmain.prototype.getEachMetaProcess = function(howmany){\n\t\t\t\t\n\t\t\t\tif(false){\n\t\t\t\t\tvar interval = setInterval(function(){\n\t\t\t\t\t\tif(i > allframes.length){\n\t\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$('body').append(allframes[i]);\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tconsole.log(i);\n\t\t\t\t\t},10);\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\tfor(var i = alldone; (i < allframes.length) && (i < alldone + howmany); i++){\n\t\t\t\t\t$('body').append(allframes[i]);\n\t\t\t\t\t$('.num').html(alldone + ' of ' + allframes.length);\n\t\t\t\t}\n\n\t\t\t\talldone = alldone + howmany;\n\t\t\t\t\n\t\t\t}\n\t\t\tmain.prototype.processFrame = function(frame){\n\t\t\t\tvar frame = $(frame);\n\t\t\t\tif(frame){\n\t\t\t\t\tvar _this = frame.contents();\n\t\t\t\t\tvar el = _this.find('#product_details');\n\t\t\t\t\tvar obj = bigData[frame.attr('data-console')][frame.attr('data-game')];\n\t\t\t\t\t\n\t\t\t\t\tobj.img = el.find('.cover img').attr('src');\n\t\t\t\t\tobj.upc = el.find('p').clone().find('span').remove().end().text().replace(/\\n/g,'').split(' ');\n\t\t\t\t\tobj.upc = clean(obj.upc)[0];\n\t\t\t\t\tobj.date = el.find('.date').text();\n\t\t\t\t\tobj.date = (obj.date) ? moment(obj.date,'D MMM YYYY').unix() : '';\n\t\t\t\t\t\n\t\t\t\t\t//console.log(obj);\n\t\t\t\t\t\n\t\t\t\t\tframe.remove();\n\t\t\t\t}\n\t\t\t}\n\t\t\tmain.prototype.getEachGameMeta = function(){\n\t\t\t\t\n\t\t\t\t$.getJSON('console_obj.json',function(r){\n\t\t\t\t\n\t\t\t\t\t$.map(r,function(v,k){\n\t\t\t\t\t\t$.map(v,function(vv,kk){\n\t\t\t\t\t\t\tbigData[k].push(vv);\n\t\t\t\t\t\t\tvar frame = $('<iframe onload=\"games.processFrame(this)\" data-console=\"'+k+'\" data-game=\"'+kk+'\" src=\"http://videogames.pricecharting.com/game/'+k+'/'+vv.safename+'\"></iframe)');\n\t\t\t\t\t\t\tallframes.push(frame);\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\tmain.prototype.getAllGames = function(){\n\t\t\t\tvar _this = this;\n\t\t\t\tvar consoles = _this.opts.consoles;\n\t\t\t\tvar getIt = function(con,p){\n\t\t\t\t\tgames.gamesJson(con,p++,function(d){\n\t\t\t\t\t\tconsole.log(d);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tfor(var i = 0; i < consoles.length; i++){\n\n\t\t\t\t\tvar test = new getIt(consoles[i],0);\n\t\t\t\t\t\n\t\t\t\t};\n\t\t\t}\n\t\t\t\n\t\t\tmain.prototype.gamesJson = function(plat, page, cb){\n\t\t\t\tvar _this = this;\n\t\t\t\tvar bust = new Date().getTime();\n\t\t\t\tvar next;\n\t\t\t\t$.getJSON('search.php?console='+plat+'&page='+page+'&cache='+bust,function(r){\n\t\t\t\t\tif(r.next_page){\n\t\t\t\t\t\tnext = JSON.parse('{\"' + decodeURI(r.next_page.replace(/&/g, \"\\\",\\\"\").replace(/=/g,\"\\\":\\\"\")) + '\"}');\n\t\t\t\t\t\tconsole.log(next.page);\n\t\t\t\t\t\tnext = next.page;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnext = false;\n\t\t\t\t\t}\n\t\t\t\t\t$.map(r.products,function(i){\n\t\t\t\t\t\ti[1] = r.genres[i[1]];\n\t\t\t\t\t\tbigData[plat].push(i);\n\t\t\t\t\t\treturn i;\n\t\t\t\t\t});\n\t\t\t\t\tconsole.log(r);\n\t\t\t\t\tif(next){\n\t\t\t\t\t\t_this.gamesJson(plat,next);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\tvar games = new main();\n\t\t\t\n\t\t\tfunction doit(e){\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t\t\n\t\t\t$(document).ready(function(){\n\t\t\t\t\n\t\t\t\tgames.init({\n\t\t\t\t\tconsoles: [\n\t\t\t\t\t\t'nes',\n\t\t\t\t\t\t'super-nintendo',\n\t\t\t\t\t\t'nintendo-64',\n\t\t\t\t\t\t'gamecube',\n\t\t\t\t\t\t'wii',\n\t\t\t\t\t\t'wii-u',\n\t\t\t\t\t\t'gameboy-color',\n\t\t\t\t\t\t'gameboy-advance',\n\t\t\t\t\t\t'nintendo-ds',\n\t\t\t\t\t\t'nintendo-3ds',\n\t\t\t\t\t\t'virtual-boy',\n\t\t\t\t\t\t'playstation',\n\t\t\t\t\t\t'playstation-2',\n\t\t\t\t\t\t'playstation-3',\n\t\t\t\t\t\t'psp',\n\t\t\t\t\t\t'playstation-vita',\n\t\t\t\t\t\t'sega-genesis',\n\t\t\t\t\t\t'sega-master-system',\n\t\t\t\t\t\t'sega-saturn',\n\t\t\t\t\t\t'sega-dreamcast',\n\t\t\t\t\t\t'sega-cd',\n\t\t\t\t\t\t'sega-game-gear',\n\t\t\t\t\t\t'atari-2600',\n\t\t\t\t\t\t'atari-5200',\n\t\t\t\t\t\t'atari-7800',\n\t\t\t\t\t\t'atari-400',\n\t\t\t\t\t\t'atari-lynx',\n\t\t\t\t\t\t'jaguar',\n\t\t\t\t\t\t'xbox',\n\t\t\t\t\t\t'xbox-360',\n\t\t\t\t\t\t'3do',\n\t\t\t\t\t\t'cd-i',\n\t\t\t\t\t\t'colecovision',\n\t\t\t\t\t\t'commodore-64',\n\t\t\t\t\t\t'intellivision',\n\t\t\t\t\t\t'macintosh',\n\t\t\t\t\t\t'n-gage',\n\t\t\t\t\t\t'neo-geo',\n\t\t\t\t\t\t'neo-geo-pocket-color',\n\t\t\t\t\t\t'odyssey-2',\n\t\t\t\t\t\t'pc-games',\n\t\t\t\t\t\t'turbografx-16',\n\t\t\t\t\t\t'vectrex',\n\t\t\t\t\t\t'vic-20'\n\t\t\t\t\t]\n\t\t\t\t});\n\n\t\t\t\t$('.mainsearch').blur(function(e){\n\t\t\t\t\tvar thisType = $(this).val();\n\t\t\t\t\tif(thisType != \"\"){\n\t\t\t\t\t\tdelay(function(){\n\t\t\t\t\t\t  doSearch(thisType);\n\t\t\t\t\t\t}, 450);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelay(function(){\n\t\t\t\t\t\t  removeList();\n\t\t\t\t\t\t}, 150);\n\t\t\t\t\t}\n\t\t\t\t}).focus(function(){\n\t\t\t\t\t$(this).val(\"\");\n\t\t\t\t}).submit(function(){\n\t\t\t\t\t$(this).blur();\n\t\t\t\t\treturn false;\n\t\t\t\t}).keyup(function(e){\n\t\t\t\t\tif(e.keyCode == 13){\n\t\t\t\t\t\t$(this).blur()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t});\n\n\t\t\t\n\t\t</script>\n\t\t<script id=\"itemTmpl\" type=\"text/x-jquery-tmpl\">\n\t\t\t<a class=\"toplevel\" href=\"#detail\" data-index=\"${index}\">\n\n\t\t\t</a>\n\t\t</script>\n\n\t</head>\n\t<body>\n\t\t<div class=\"container\">\n\t\t\t<span class=\"num\"></span>\n\t\t</div>\n\t</body>\n</html>"]],"start1":0,"start2":0,"length1":0,"length2":6856}]],"length":6856}
